{%  extends 'base.html.twig' %}

{%  block body %}

    <h1>RECHERCHER UNE SORTIE </h1>
    <div class="infos">
        Date du jour : {{ "now" | date("d/m/Y") }}
        {%  if app.user %}
            <b>Salut {{ app.user.userIdentifier }} </b>
        {%  endif %}
    </div>

    <div class="formulaire">

        <h2>Filtrer les sorties :</h2>

            {{ form_start(sortieForm) }}
            {{ form_widget(sortieForm) }}
            <button>Rechercher !</button>
            {{ form_end(sortieForm) }}
    </div>

    <h2>{{ sorties | length }} sorties trouvées :</h2>

    <table>
        <tr>
            <th>Nom de la sortie</th>
            <th>Date de la sortie</th>
            <th>Clôture</th>
            <th>Inscrits/Places</th>
            <th>Campus</th>
            <th>Etat</th>
            <th>Inscrit</th>
            <th>Organisateur</th>
            <th>Actions</th>
        </tr>

        {% for sortie in sorties %}
            <tr>
                <td>{{ sortie.nom }}</td>
                <td>{{ sortie.dateHeureDebut | date("d/m/Y H:i") }}</td>
                <td>{{ sortie.dateLimiteInscription | date("d/m/Y") }}</td>
                <td>{{ sortie.participants | length }}/{{ sortie.nbInscriptionsMax }}</td>
                <td>{{ sortie.campus.nom }}</td>
                <td>{{ sortie.etat.libelle }}</td>
                <td>
                    {%  if app.user and sortie in sortiesInscrit %}
                        Oui
                    {%  else %}
                        Non
                    {%  endif %}
                <td>
                    {%  if app.user and app.user == sortie.organisateur %}
                        Oui
                    {%  else %}
                        Non
                    {%  endif %}
                </td>
                <td>
                    <a href="{{ path('sortie_detail', {'id': sortie.id}) }}">Afficher</a>
                    {%  if app.user and app.user == sortie.organisateur and sortie.etat.libelle == 'en création' %}
                    <a href="{{ path('sortie_modifier', {'id': sortie.id}) }}">Modifier</a>
                    {%  endif %}

                    {%  if app.user and app.user == sortie.organisateur and sortie.etat.libelle == 'Créée' %}
                        <a href="{{ path('sortie_annuler', {'id': sortie.id}) }}">Annuler</a>
                    {%  endif %}

                    {%  if app.user and sortie not in sortiesInscrit and sortie.etat.libelle == 'Ouverte' and (sortie.inscriptions | length) < sortie.nbInscriptionsMax and sortie.dateLimiteInscription > "now" %}
                        <a href="{{ path('sortie_inscription', {'id': sortie.id}) }}">S'inscrire</a>
                    {%  endif %}

                    {%  if app.user and sortie in sortiesInscrit and (sortie.etat.libelle == 'Ouverte' or sortie.etat.libelle == 'Clôturée') and sortie.dateLimiteInscription > "now" %}
                        <a href="{{ path('sortie_desinscription', {'id': sortie.id}) }}"
                           onclick="return confirm('Voulez-vous vraiment vous désinscrire de la sortie {{ sortie.nom }} ?')">Se désister</a>
                    {%  endif %}
                </td>
        </tr>

        {%  else %}
            <p>Aucune sortie ne correspond à vos critères</p>
        {%  endfor %}

    </table>

    <button>
        <a href="{{ path('sortie_creer') }}">Creer une sortie </a>
    </button>
{%  endblock %}
{% block title %}

{% endblock %}

